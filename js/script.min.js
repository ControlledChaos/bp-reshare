/*! bp-reshare - v2.0.0-beta1 - 2017-07-17 5:59:23 PM UTC - https://imathi.eu/tag/reshare */
window.bpReshare=window.bpReshare||{},function(a,b){"undefined"!=typeof a.templates&&(a.activities=[],a.disabledActivities={},a.getURLparams=function(a,b){var c;if(c=a?-1!==a.indexOf("?")?"?"+a.split("?")[1]:"":document.location.search,!c)return null;var d=c.replace(/(^\?)/,"").split("&").map(function(a){return a=a.split("="),this[a[0]]=a[1],this}.bind({}))[0];return b?d[b]:d},a.isTypeDisabled=function(c,d,e){if(!c)return!0;var f=!1;if(d)f=a.params.disabled_types&&-1!==b.inArray(d,a.params.disabled_types);else if("undefined"==typeof a.disabledActivities[c]){var g=b("#activity-"+c).prop("class");!g&&e&&(g=b(e).prop("class")),g=g.split(" "),a.params.disabled_types&&(b.each(a.params.disabled_types,function(a,c){-1!==b.inArray(c,g)&&(f=!0)}),a.disabledActivities[c]=f)}else f=a.disabledActivities[c];return f},a.IndexOf=function(a,c){var d=-1;return c=c||[],a&&b.isArray(c)?(b.each(c,function(b,c){a===c.id&&(d=b)}),d):d},a.getTimeSince=function(c){var d,e,f,g,h,i,j=new Date(b.now()),k=[],l=b.extend({},a.params.time_since.time_chunks);if(void 0===c)return a.params.time_since.sometime;if(c=new Date(1e3*c),d=j-c,1e3>d)return a.params.time_since.now;b.each(l,function(a,b){var c=1e3*b,g=Math.floor(d/c);0===g||f||(f=a,e=g,i=c)}),f=f.substr(2),k.push(1===e?a.params.time_since[f].replace("%",e):a.params.time_since[f+"s"].replace("%",e)),delete l.a_year,b.each(l,function(a,b){var c=1e3*b,f=Math.floor((d-i*e)/c);0===f||h||(h=a,g=f)}),void 0!==h&&(h=h.substr(2),k.push(1===g?a.params.time_since[h].replace("%",g):a.params.time_since[h+"s"].replace("%",g)));var m=a.params.time_since.sometime;return k.length>=1&&(m=a.params.time_since.ago.replace("%",k.shift())),"&nbsp;"+m},a.refreshActivity=function(c){if(!c)return!1;var d,e,f={link:"addLink",text:"addReshare"},g={},h=".activity-header a.activity-time-since";if(c.id)g=c;else{c=parseInt(c,10);var i=a.IndexOf(c,a.activities);if(-1===i)return!1;g=a.activities[i]}return!(!b("#activity-"+g.id).length||!0!==g.isChecked)&&(e=b("#activity-"+g.id),!e.find(".reshare-time-since").length&&g.time&&(e.prop("class",e.prop("class").replace(/date-recorded-([0-9]+)/,"date-recorded-"+g.time)),e.find(h).length||(h=".activity-header span.time-since"),e.find(h).after(b("<span></span>").addClass("reshare-time-since").html(a.getTimeSince(g.time)))),d=e.find(".bp-reshare").first(),d.find("span.count").first().html(g.users.length),-1!==b.inArray(a.params.u.toString(),g.users)&&(f={link:"removeLink",text:"removeReshare"}),d.prop("href",a.strings[f.link].replace("%i",g.id)).removeClass("add-reshare remove-reshare").addClass("removeLink"===f.link?"remove-reshare":"add-reshare"),d.find(".bp-screen-reader-text").html(a.strings[f.text]),!0)},a.get=function(){if(!b(".bp-reshare").length)return!1;var c=[];return b.each(a.activities,function(b,d){if(!0===a.activities[b].isChecked)a.refreshActivity(d);else{if(a.isTypeDisabled(d.id))return;c.push(d.id),a.activities[b].isChecked=!0}}),c.length&&a.Ajax.get("all",{activities:c.join(",")},function(c,d){if(200===c){if(!b.isArray(d)||!d.length)return;b.each(d,function(b,c){var d=parseInt(c.id,10),e=a.IndexOf(d,a.activities);-1!==e&&(a.activities[e].users=c.users,a.activities[e].time=c.time,a.refreshActivity(d))})}}),!0},a.Scan=function(c){return!!c&&(b.each(b(c).children(),function(c,d){var e=parseInt(b(d).prop("id").replace("activity-",""),10);e&&!a.isTypeDisabled(e,null,d)&&-1===a.IndexOf(e,a.activities)&&a.activities.push({id:e,users:[],markUp:!1,isChecked:!1})}),!0)},a.setMarkup=function(){return!!a.activities.length&&(b.each(a.activities,function(c,d){var e=b("#activity-"+d.id),f=b(e).find(".activity-header a").first().prop("href");if(e.length&&!b(e).find("a.bp-reshare").length&&!a.isTypeDisabled(d.id)){if(!1===d.markUp){var g=b.trim(f.replace(a.params.root_members,""),"/").split("/")[0],h="add-reshare";g===a.params.u_nicename&&(h="disabled"),a.activities[c].markUp=a.templates.reshareButton.replace("%l",a.strings.addLink.replace("%i",d.id)).replace("%r",h).replace("%a",d.id).replace("%u",g).replace("%t",a.strings.addReshare).replace("%c",0)}b(e).find(".activity-meta a").first().after(a.activities[c].markUp)}}),!0)},a.isResharesScope=function(){return"reshares"===decodeURIComponent(document.cookie).split(";").map(function(a){var c=a.split("=");if("bp-activity-scope"===b.trim(c[0]))return b.trim(c[1])}).filter(function(a){if(a)return a}).shift()},a.activityTab=function(c,d){a.params.u_count=parseInt(a.params.u_count,10),(a.params.u_count||c)&&(c?"-1"===c?a.params.u_count-=1:a.params.u_count+=parseInt(c,10):c=a.params.u_count,b("body.directory #activity-reshares").length?b("body.directory #activity-reshares").find("span").first().html(a.params.u_count):b("body.directory .activity-type-tabs ul li").first().after(b(a.templates.directoryTab.replace("%c",a.params.u_count)).addClass(!0===d?"selected":"")))},a.Button=function(b,c){c||(c="#activity-stream"),!0===a.Scan(c)&&("populate"===b?(a.setMarkup(),a.get()):window.setTimeout(function(){a.setMarkup(),a.get()},500))},b(document).ready(function(){a.Button("populate"),a.activityTab(null,a.isResharesScope())}),b(document).ajaxSuccess(function(c,d,e){var f,g=decodeURIComponent(e.data),h=a.getURLparams("?"+g,"action"),i=e.url&&-1!==e.url.indexOf(a.params.root_url);i||-1===b.inArray(h,["activity_get_older_updates","activity_widget_filter","post_update"])||("post_update"===h?f=b("<ul></ul>").html(d.responseText):(f=b(d.responseJSON.contents)[0],"LI"===f.nodeName&&(f=b("<ul></ul>").html(b.map(b(d.responseJSON.contents),function(a){return b(a).prop("outerHTML")}).join(" "))),"activity_widget_filter"===h&&(a.activities=[])),a.Button("refresh",f))}),b("body.activity #buddypress").on("click",".load-newest a",function(c){var d=b(c.currentTarget).closest("ul"),e=b(c.currentTarget).parent();window.setTimeout(function(){var c=b("<ul></ul>").html(b.map(b(d.find(".just-posted")),function(a){return b(a).prop("outerHTML")}).join(" "));a.Button("populate",c),e.length&&e.remove()},500)}),a.add=function(c){var d=c.currentTarget,e=b(d).data("activity-id"),f=b(d).data("author-name"),g=b(d).find("span.count").first(),h=".activity-header a.activity-time-since";c.preventDefault(),f!==a.params.u_nicename&&(b(d).hasClass("add-reshare")?a.Ajax.post(e,{user_id:a.params.u,author_slug:f},function(c,f){if(200===c&&f.reshared)b(d).closest(".activity-content").find(".reshare-time-since").remove(),b("#activity-"+e).find(h).length||(h=".activity-header span.time-since"),b(d).removeClass("add-reshare").addClass("remove-reshare").prop("href",a.strings.removeLink.replace("%i",e)).closest(".activity-content").find(h).after(b("<span></span>").addClass("reshare-time-since").html(a.getTimeSince(f.reshared))),b(g).html(parseInt(b(g).html(),10)+1),a.activityTab(1);else{var i=a.strings.genericError;f.message&&(i=f.message),a.Ajax.feedback(b(d).closest(".activity-meta").get(0),i,"error")}}):b(d).hasClass("remove-reshare")&&a.Ajax.remove(e,{user_id:a.params.u,author_slug:f},function(c,f){if(200===c)b(d).removeClass("remove-reshare").addClass("add-reshare").prop("href",a.strings.addLink.replace("%i",e)).closest(".activity-content").find(".reshare-time-since").remove(),b(g).html(parseInt(b(g).html(),10)-1),a.activityTab("-1"),a.isResharesScope()&&b("#activity-"+e).remove();else{var h=a.strings.genericError;f.message&&(h=f.message),a.Ajax.feedback(b(d).closest(".activity-meta").get(0),h,"error")}}))},b("#buddypress").on("click",".bp-reshare",a.add),b("#buddypress").on("change.livestamp",".time-since",function(c){var d,e,f=b(c.currentTarget).parents("li").first(),g=f.find(".bp-reshare").first();b(g).length&&(d=parseInt(b(g).data("activity-id"),10),e=a.IndexOf(d,a.activities),-1!==e&&b(f).find(".reshare-time-since").html(a.getTimeSince(a.activities[e].time)))}))}(window.bpReshare,jQuery);