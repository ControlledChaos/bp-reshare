/*! bp-reshare - v2.0.0 - 2017-07-24 4:43:29 PM UTC - https://imathi.eu/tag/reshare */
window.bpReshare=window.bpReshare||{},function(a,b){"undefined"!=typeof a.activity&&(a.outputNoItem=function(c,d,e){if(!b(c).find("#message").length){var f="info";e?f+=" keep":e=a.activity.nav[d].no_item,"comments"!==d&&b(c).html(""),b(c).prepend(b("<div></div>").prop("id","message").addClass(f).html("<p>"+e+"</p>"))}},a.getLoading=function(c){b(c).html(b("<div></div>").css({background:"url( "+a.activity.loader+" ) no-repeat",width:"100%",height:"40px","background-position":"50% 50%"}))},a.getUsers=function(c,d,e){e||(e=1),1===e&&a.getLoading(c);var f={type:d,include:a.activity.nav[d].users.join(","),page:e};a.Ajax.get(a.activity.id,f,function(f,g){if(200===f&&g.users)a.activity.nav[d].usersDetail=g.users,g.has_more&&(a.activity.nav[d].nextPage=e+1,g.users.loadmore='<li class="load-more-users"><a href="#" data-next-page="'+a.activity.nav[d].nextPage+'">Load More</a></li>'),1!==e&&b("#"+d+"-users").length?b(c).find(".loading").length&&b(c).find(".loading").remove():b(c).html(b("<ul></ul>").prop({id:d+"-users",class:"item-list","aria-live":"assertive","aria-relevant":"all"})),b.each(g.users,function(a,c){b("#"+d+"-users").append(c)});else{var h=a.strings.genericError;g.message&&(h=g.message),b(c).find("div").first().css({background:"none"}),a.Ajax.feedback(b(c).get(0),h,"error")}})},a.activityNav=function(){var c=0,d=[];b.each(a.activity.nav,function(e,f){var g;f.count=0,c===f.position&&("comments"===e?f.count=parseInt(b("#acomment-comment-"+a.activity.id+" span").html(),10):f.count=f.users.length,g=1>=f.count?f.singular:f.plural,d.push(b("<a></a>").html(g).prop({id:"display-"+e,href:"#display-"+e}).get(0).outerHTML)),c++}),b("#activity-"+a.activity.id+" .activity-comments").before(b("<ul></ul>").html("<li>"+d.join("</li><li>")+"</li>").prop("id","buddyreshare-activity-nav")).addClass("buddyreshare-nav-content"),b("#display-comments").parent().addClass("selected"),0===a.activity.nav.comments.count?a.outputNoItem("#activity-"+a.activity.id+" .activity-comments","comments"):b("#activity-"+a.activity.id+" .activity-comments").get(0).children.length||a.outputNoItem("#activity-"+a.activity.id+" .activity-comments","comments",a.activity.nav.comments.no_comments),a.activity.nav.favorites&&a.activity.nav.favorites.count&&b("#activity-"+a.activity.id+" .activity-meta").find(".fav, .unfav").prepend("&nbsp;").prepend(b("<span></span>").addClass("count").html(a.activity.nav.favorites.count))},b("#buddypress").on("click","#buddyreshare-activity-nav li a",function(c){var d=b(c.currentTarget),e=d.prop("id").replace("display","activity"),f=d.prop("id").replace("display-","");c.preventDefault(),b.each(b("#buddyreshare-activity-nav li a"),function(a,c){b(c).parent().removeClass("selected"),b(c).prop("id")===d.prop("id")&&b(c).parent().addClass("selected")}),b("#activity-"+a.activity.id+" ."+e).length||b("#activity-"+a.activity.id).append(b("<div></div>").addClass(e+" buddyreshare-nav-content")),b.each(b(".buddyreshare-nav-content"),function(c,d){b(d).hasClass(e)?(b(d).show(),0===a.activity.nav[f].count?a.outputNoItem(d,f):(b(d).find("#message").hasClass("keep")||b(d).find("#message").remove(),b(d).hasClass("activity-comments")||a.getUsers(d,f))):b(d).hide()})}),b("#buddypress").on("click",".buddyreshare-nav-content .load-more-users a",function(c){c.preventDefault();var d=b(c.currentTarget).data("next-page"),e=b(c.currentTarget).closest(".buddyreshare-nav-content"),f=b(e).prop("class").split(" ")[0].replace("activity-","");b(c.currentTarget).parent().addClass("loading").html(a.getLoading(b(this))),a.getUsers(e,f,d)}),a.refreshCounts=function(c,d,e){var f=0;return"comments"!==c?("-1"===e?a.activity.nav[c].users.splice(a.activity.nav[c].users.indexOf(d.toString()),1):1===e&&a.activity.nav[c].users.push(d.toString()),f=a.activity.nav[c].users.length,b("#display-comments").trigger("click")):(f=e,b(".activity-comments").find("#message.info").remove()),f<=1?b("#display-"+c).html(a.activity.nav[c].singular):b("#display-"+c).html(a.activity.nav[c].plural),f},b("#buddypress .activity-meta").on("click","a",function(c){if(!a.isTypeDisabled(a.activity.id)){var d=0;b(c.currentTarget).hasClass("acomment-reply")?b("#display-comments").trigger("click"):b(c.currentTarget).hasClass("bp-reshare")&&(b(c.currentTarget).hasClass("add-reshare")?d=1:b(c.currentTarget).hasClass("remove-reshare")&&(d="-1"),a.activity.nav.reshares.count=a.refreshCounts("reshares",a.params.u,d))}}),b(document).ajaxSuccess(function(c,d,e){if(!a.isTypeDisabled(a.activity.id)){var f=decodeURIComponent(e.data),g=1,h=a.getURLparams("?"+f,"action");"activity_mark_fav"===h||"activity_mark_unfav"===h?("activity_mark_unfav"===h&&(g="-1"),a.activity.nav.favorites.count=a.refreshCounts("favorites",a.params.u,g),window.setTimeout(function(){b("#activity-"+a.activity.id+" .activity-meta").find(".fav, .unfav").html(b("<span></span>").addClass("count").html(a.activity.nav.favorites.count).get(0).outerHTML+"&nbsp;"+d.responseText)},500)):"delete_activity_comment"!==h&&"new_activity_comment"!==h||("delete_activity_comment"===h?a.activity.nav.comments.count-=1:a.activity.nav.comments.count+=1,a.refreshCounts("comments",!1,a.activity.nav.comments.count))}}),b(document).ready(function(){a.isTypeDisabled(a.activity.id)||a.activityNav()}))}(window.bpReshare,jQuery);